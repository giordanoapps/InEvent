/*!
 * jQuery Smart Banner
 * Copyright (c) 2012 Arnold Daniels <arnold@jasny.net>
 * Based on 'jQuery Smart Web App Banner' by Kurt Zenisek @ kzeni.com
 */
!function(b){var a=function(d){this.origHtmlMargin=parseFloat(b("html").css("margin-top"));this.options=b.extend({},b.smartbanner.defaults,d);var c=navigator.standalone;if(this.options.force){this.type=this.options.force}else{if(navigator.userAgent.match(/iPad|iPhone|iPod/i)!=null){if(navigator.userAgent.match(/Safari/i)!=null&&(navigator.userAgent.match(/CriOS/i)!=null||window.Number(navigator.userAgent.substr(navigator.userAgent.indexOf("OS ")+3,3).replace("_","."))<6)){this.type="ios"}}else{if(navigator.userAgent.match(/Android/i)!=null){this.type="android"}}}if(!this.type||c||this.getCookie("sb-closed")||this.getCookie("sb-installed")){return}this.scale=this.options.scale=="auto"?b(window).width()/window.screen.width:this.options.scale;if(this.scale<1){this.scale=1}var e=b(this.type=="android"?'meta[name="google-play-app"]':'meta[name="apple-itunes-app"]');if(e.length==0){return}this.appId=/app-id=([^\s,]+)/.exec(e.attr("content"))[1];this.title=this.options.title?this.options.title:b("title").text().replace(/\s*[|\-Â·].*$/,"");this.author=this.options.author?this.options.author:(b('meta[name="author"]').length?b('meta[name="author"]').attr("content"):window.location.hostname);this.create();this.show();this.listen()};a.prototype={constructor:a,create:function(){var d,c=(this.options.url?this.options.url:(this.type=="android"?"market://details?id=":("https://itunes.apple.com/"+this.options.appStoreLanguage+"/app/id"))+this.appId),f=this.options.price?this.options.price+" - "+(this.type=="android"?this.options.inGooglePlay:this.options.inAppStore):"",e=this.options.iconGloss===null?(this.type=="ios"):this.options.iconGloss;b("body").append('<div id="smartbanner" class="'+this.type+'"><div class="sb-container"><a href="#" class="sb-close">&times;</a><span class="sb-icon"></span><div class="sb-info"><strong>'+this.title+"</strong><span>"+this.author+"</span><span>"+f+'</span></div><a href="'+c+'" class="sb-button"><span>'+this.options.button+"</span></a></div></div>");if(this.options.icon){d=this.options.icon}else{if(b('link[rel="apple-touch-icon-precomposed"]').length>0){d=b('link[rel="apple-touch-icon-precomposed"]').attr("href");if(this.options.iconGloss===null){e=false}}else{if(b('link[rel="apple-touch-icon"]').length>0){d=b('link[rel="apple-touch-icon"]').attr("href")}}}if(d){b("#smartbanner .sb-icon").css("background-image","url("+d+")");if(e){b("#smartbanner .sb-icon").addClass("gloss")}}else{b("#smartbanner").addClass("no-icon")}this.bannerHeight=b("#smartbanner").outerHeight()+2;if(this.scale>1){b("#smartbanner").css("top",parseFloat(b("#smartbanner").css("top"))*this.scale).css("height",parseFloat(b("#smartbanner").css("height"))*this.scale);b("#smartbanner .sb-container").css("-webkit-transform","scale("+this.scale+")").css("-msie-transform","scale("+this.scale+")").css("-moz-transform","scale("+this.scale+")").css("width",b(window).width()/this.scale)}},listen:function(){b("#smartbanner .sb-close").on("click",b.proxy(this.close,this));b("#smartbanner .sb-button").on("click",b.proxy(this.install,this))},show:function(c){b("#smartbanner").stop().animate({top:0},this.options.speedIn).addClass("shown");b("html").animate({marginTop:this.origHtmlMargin+(this.bannerHeight*this.scale)},this.options.speedIn,"swing",c)},hide:function(c){b("#smartbanner").stop().animate({top:-1*this.bannerHeight*this.scale},this.options.speedOut).removeClass("shown");b("html").animate({marginTop:this.origHtmlMargin},this.options.speedOut,"swing",c)},close:function(c){c.preventDefault();this.hide();this.setCookie("sb-closed","true",this.options.daysHidden)},install:function(c){this.hide();this.setCookie("sb-installed","true",this.options.daysReminder)},setCookie:function(c,e,d){var f=new Date();f.setDate(f.getDate()+d);e=escape(e)+((d==null)?"":"; expires="+f.toUTCString());document.cookie=c+"="+e+"; path=/;"},getCookie:function(d){var e,c,g,f=document.cookie.split(";");for(e=0;e<f.length;e++){c=f[e].substr(0,f[e].indexOf("="));g=f[e].substr(f[e].indexOf("=")+1);c=c.replace(/^\s+|\s+$/g,"");if(c==d){return unescape(g)}}return null},switchType:function(){var c=this;this.hide(function(){c.type=c.type=="android"?"ios":"android";var d=b(c.type=="android"?'meta[name="google-play-app"]':'meta[name="apple-itunes-app"]').attr("content");c.appId=/app-id=([^\s,]+)/.exec(d)[1];b("#smartbanner").detach();c.create();c.show()})}};b.smartbanner=function(d){var f=b(window),e=f.data("typeahead"),c=typeof d=="object"&&d;if(!e){f.data("typeahead",(e=new a(c)))}if(typeof d=="string"){e[d]()}};b.smartbanner.defaults={title:null,author:null,price:"FREE",appStoreLanguage:"us",inAppStore:"On the App Store",inGooglePlay:"In Google Play",icon:null,iconGloss:null,button:"VIEW",url:null,scale:"auto",speedIn:300,speedOut:400,daysHidden:15,daysReminder:90,force:null};b.smartbanner.Constructor=a}(window.jQuery);